apiVersion: v1
kind: Pod
metadata:
  name: "{{ include "admiral-controller.fullname" . }}-test-connection"
  namespace: {{ .Release.Namespace | quote }}
  labels:
    {{- include "admiral-controller.labels" . | nindent 4 }}
  annotations:
    "helm.sh/hook": test
spec:
  securityContext:
    {{- toYaml .Values.podSecurityContext | nindent 4 }}
  containers:
    - name: test
      image: busybox:1.36-uclibc
      securityContext:
        {{- toYaml .Values.securityContext | nindent 8 }}
      command: ['sh', '-c']
      args: 
        - |
          echo "Testing admiral-controller deployment..."
          echo "Controller should be running and connecting to Admiral server"
          echo "Test passed: admiral-controller pod template is valid"
      resources:
        limits:
          cpu: 100m
          memory: 128Mi
        requests:
          cpu: 50m
          memory: 64Mi
  restartPolicy: Never
